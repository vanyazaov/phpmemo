---
layout: note
title: "Функция microtime()"
card_id: 005
date: 2025-09-14
card_type: theory # theory, technique, practice
categories: ["PHP Basics"]
difficulty: 1 # Уровень сложности (опционально)
icon: book # book, lightning-bolt, check-circle (соответствует типу)
question: |
  ```php
  microtime(bool $as_float = false): string|float
  ```
  Расскажите об этой функции всё, что знаете.

short_answer: |
  **Назначение:**
  Возвращает текущее время в секундах и микросекундах. Для замеров скорости выполнения, генерации уникальных ID.

  **Параметры:**
  *   `false` (по умолч.): строка `"микросекунды секунды"`
  *   `true`: число `float` (`секунды.микросекунды`)
  
  **Особенности:**
  *   Реальная точность зависит от ОС.
  *   Не является надежным источником абсолютного времени (часы могут сдвигаться).
---

### **Подробное объяснение `microtime()`**

**1. Что это?**
`microtime()` — это встроенная функция PHP, которая возвращает текущую метку времени Unix (timestamp) с **микросекундами**. В отличие от `time()`, которая возвращает целое число секунд, `microtime()` позволяет измерять время с очень высокой точностью.

**2. Синтаксис:**
```php
microtime(bool $as_float = false): string|float
```

**3. Возвращаемые значения (в зависимости от параметра):**
*   **`$as_float = FALSE` (по умолчанию):**
    *   Возвращает строку в формате `"микросекунды секунды"`.
    *   **Пример:** `"0.12345678 1678901234"`
    *   Где `0.12345678` — это дробная часть секунды (микросекунды), а `1678901234` — целая часть (секунды с начала эпохи Unix).
    *   Такое представление неудобно для математических операций.

*   **`$as_float = TRUE`:**
    *   Возвращает число с плавающей точкой (float).
    *   **Пример:** `1678901234.12345678`
    *   Это число представляет собой количество секунд с начала эпохи Unix (1 января 1970 года) до текущего момента, включая дробную часть с микросекундами.
    *   **Этот формат предпочтительнее для вычислений,** особенно для замеров времени выполнения.

**4. Основное применение:**
*   **Бенчмаркинг и профилирование:** Точный замер времени выполнения участка кода или SQL-запроса.
    ```php
    $start = microtime(true);
    // ... какой-то медленный код ...
    $end = microtime(true);
    $time_taken = $end - $start;
    echo "Скрипт выполнялся " . round($time_taken, 4) . " секунд(ы)";
    ```
*   **Генерация уникальных идентификаторов:** Часто используется в сочетании с другими функциями (например, `uniqid()`) для создания более уникальных ID, так как добавляет микросекундную точность.
*   **Логирование с высокой точностью:** Когда важно зафиксировать не только секунду, но и долю секунды, в которую произошло событие.

**5. Важные нюансы:**
*   **Точность зависит от платформы:** Хотя функция возвращает микросекунды, реальная точность зависит от операционной системы. В Windows точность часто хуже, чем в Linux.
*   **Не для точного времени:** Функция возвращает время системы. Если системные часы будут сдвинуты (например, из-за синхронизации с NTP-сервером), то значение может даже уменьшиться между двумя вызовами. Не используйте её для генерации абсолютного времени для критичных операций.
*   **Для замеров производительности — всегда используйте `$as_float = true`.** Работать с float числами (вычитать, сравнивать) намного проще и быстрее, чем парсить строку.
*   **Переполнение:** На 32-битных системах целая часть секунд (timestamp) "переполнится" 19 января 2038 года (проблема 2038 года). На 64-битных системах этой проблемы нет.

**6. Версии PHP:**
*   Функция существует с очень **старых версий PHP (PHP 4+)**.
*   Критически важный параметр **`$as_float` был добавлен в PHP 5.0.0**.
*   Полностью актуальна для всех современных версий (PHP 5, 7, 8).
